FROM golang:1.25-bookworm AS builder
WORKDIR /src
COPY . .
RUN mkdir -p /out && CGO_ENABLED=0 GOOS=linux go build -trimpath -ldflags='-s -w' -o /out/jpeg-thumbnail .

FROM debian:bookworm-slim
RUN apt-get update && apt-get install -y --no-install-recommends ffmpeg ca-certificates \
    && rm -rf /var/lib/apt/lists/*
COPY --from=builder /out/jpeg-thumbnail /usr/local/bin/jpeg-thumbnail
ENTRYPOINT ["/usr/local/bin/jpeg-thumbnail"]
